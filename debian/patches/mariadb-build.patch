Last-Update: 2016-11-13
Forwarded: not-needed
Origin: https://packages.altlinux.org/en/p8/srpms/mysql-workbench-community/patches/mysql-workbench-mariadb-build.patch
Author: Dmitry Smirnov <onlyjob@member.fsf.org>
Description: fix FTBFS with MariaDB.
 mysql_real_escape_string_quote() has been implemented as a replacement
 for mysql_real_escape_string() in MySQL 5.7.6 but is not implemented
 in libmysqlclient of MariaDB 10.0.21

--- a/plugins/migration/copytable/copytable.cpp
+++ b/plugins/migration/copytable/copytable.cpp
@@ -2870,17 +2870,10 @@
 
   // This function is used to create a legal SQL string that you can use in an SQL statement
   // This is needed because the escaping depends on the character set in use by the server
   #if defined(MYSQL_VERSION_MAJOR) && defined(MYSQL_VERSION_MINOR) && defined(MYSQL_VERSION_PATCH)
-  #if MYSQL_CHECK_VERSION(5,7,6)
-    if (is_mysql_version_at_least(5,7,6))
-      length += mysql_real_escape_string_quote(_mysql, buffer + length, data, (unsigned long)dlength);
-    else
-      length += mysql_real_escape_string(_mysql, buffer + length, data, (unsigned long)dlength);
-  #else
     length += mysql_real_escape_string(_mysql, buffer + length, data, (unsigned long)dlength);
   #endif
-  #endif
 
   return true;
 }
 
